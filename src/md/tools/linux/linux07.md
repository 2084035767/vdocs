# 七、管理维护

## 7.1 用户权限相关命令

### 用户和权限的基本概念

**基本概念**

- **用户**是 Linux 系统工作中重要的一环，用户管理包括**用户**与**组**管理
- 在 Linux 系统中，不论是由本机或是远程登录系统，每个系统都**必须拥有一个账号**，并且**对于不同的系统资源拥有不同的使用权限**
- 在 Linux 中，可以指定每一个用户针对不同的文件或者目录的不同权限

对文件/目录的权限包括：

| 权限 | 英文   | 缩写 | 数字代号 |
| ---- | ------ | ---- | -------- |
| 读   | read   | r    | 4        |
| 写   | write  | w    | 2        |
| 执行 | excute | x    | 1        |

**组**

- Linux 为了方便用户管理，提出了组的概念，例如，几个用户为一组
- 在实际应用中，可以预先针对组设置好权限，然后将不同的用户添加到对应的组中，从而不用依次为每一个用户设置权限

**ls -l（扩展）**

ls-l 可以查看文件夹下文件的详细信息：

- **权限**：第 1 个字符如果是`d`表示目录
- 硬链接数：通俗地讲，就是有多少种方式，可以访问到当前目录/文件
- 拥有者：家目录下文件目录的拥有者通常都是当前用户
- 组
- 时间
- 名称

![https://tvax4.sinaimg.cn/large/005SZA4oly1h19eqlhkfej30zk0k0t9c.jpg](https://tvax4.sinaimg.cn/large/005SZA4oly1h19eqlhkfej30zk0k0t9c.jpg)

**chmod 简单使用 （重要）**

`chmod`可以修改**用户**/**组对文件**/**目录**的权限

> 提示：以下方式会一次性修改拥有者／组权限

命令格式如下：

```bash
chmod +/rwx 文件名|目录名
```

### 超级用户

- Linux 系统中的`root`账号通常用于**系统的维护和管理**，对操作系统的所有资源**具有所有访问权限**
- 在大多数版本的 Linux 中，都不推荐**直接使用 root 账号登录系统**
- 在 Linux 安装的过程中，系统会自动创建一个用户账号，而这个默认的用户就称为“标准用户“

### sudo

- `su`是 `substitute user`的缩写，表示**使用另一个用户的身份**
- `sudo`命令用来以其他身份来执行命令，预设的身份为`root`
- 用户使用`sudo`时，必须先输入密码，之后有**5 分钟的有效期限**，超过期限则必须重新输入密码

> 若其未经授权的用户企图使用 sudo，则会发出警告邮件给管理员

**sudo**

【功能】sudo命令的含义就是super do
指以超级管理员的身份执行某种操作
【格式】sudo 命令

**passwd**

功能：修改用户密码
【格式】passwd 用户名
【说明】该操作只充许root用户执行

**su**

【功能】转换用户
【格式】su 用户名

sudo和su

- 使用环境：由于su对切换到超级权限用户root后，权限无限制：所以su并不能担任多个管理员所管理的系统
- sudo可以针对每个管理员的技术特长和管理范围有针对性的下放权限，并且约定其使用哪些工具来完成与其相关的工作
- sudo相对于权限无限制性的su，对系统比较安全

### 组管理终端命令

提示：

- **创建组/删除组**的终端命令都需要通过`sudo`执行
- 组信息保存在`/etc/group`文件中
- `/etc` 目录是专门用来保存**系统配置信息**的目录

| 命令                      | 作用                      |
| ------------------------- | ------------------------- |
| groupadd 组名             | 添加组                    |
| groupdel 组名             | 删除组                    |
| cat/etc/group             | 确认组信息                |
| chgrp -R 组名 文件/目录名 | 递归修改文件/目录的所属组 |

### 用户管理终端命令

> 提示：创建用户/删除用户/修改其他用户密码的终端命令都需要通过 sudo 执行

**创建用户/设置密码/删除用户**

| 命令                        | 作用         | 说明                                                         |
| --------------------------- | ------------ | ------------------------------------------------------------ |
| useradd -m -g 组 新建用户名 | 添加新用户   | -m 自动建立用户家目录-g 指定用户所在的组否则会建立一个和同名的组 |
| passwd 用户名               | 设置用户密码 | 如果是普通用户直接用 passwd 可以修改自己的账户密码           |
| userdel -r 用户名           | 删除用户     | -r 选项会自动删除用户家目录                                  |
| cat/etc/passwd/             | grep 用户名  | 确认用户信息新建用户后，用户信息会保存在/etc/passwd 文件中   |

提示：

- 创建用户时，如果忘记添加`m`选项指定新用户的家目录，最简单的方法就是**删除用户，重新创建**
- 创建用户时，默认会创建一个和**用户名**同名的**组名**
- 用户信息保存在 `/etc/passd`文件中

**查看用户信息**

| 命令        | 作用                       |
| ----------- | -------------------------- |
| id [用户名] | 查看用户 UID 和 GID 信息   |
| who         | 查看当前所有登录的用户列表 |
| whoami      | 查看当前登录用户的账户名   |

**passwd 文件**

`/etc/passwd`文件存放的是用户的信息，由 6 个分号组成的 7 个信息

1. 用户名
2. 密码（x，表示加密的密码）
3. UID（用户标识）
4. GID（组标识）
5. 用户全名或本地帐号
6. 家目录
7. 登录使用的 Shell，就是登录之后 使用的终端命令， `ubuntu` 默认是`dash`

**usermod**

- `usermod`可以用来设置**用户**的**主组／附加组**和**登录`Shell`**，命令格式如下：
- **主组**：通常在新建用户时指定，在 etc/passwd 的第 4 列 GID 对应的组
- **附加组**：在`etc/group`中最后一列表示该组的用户列表，用于指定**用户的附加权限**

> 提示：设置了用户的附加组之后，需要重新登录才能生效

常用命令

```bash
#修改用户的主组（passwd中的GID）
usermod -g 组 用户名

#修改用户的附加组
usermod -G 组 用户名

#修改用户登录Shel1
usermod -s /bin/bash 用户名
```

> 注意：默认使用 useradd 添加的用户是没有权限使用 sudo 以 root 身份执行命令的，可以使用以下命令，将用户添加到 sudo 附加组中

```bash
usermod -Gs sudo 用户名

```

### which （重要）

```bash
`which`命令可以查看执行命令所在位置
```

提示：

- `/etc/passwd`是用于保存用户信息的文件
- `/usr/bin/passwd`是用于修改用户密码的程序

常用命令

```bash
#输出
#/bin/ls
which ls

#输出
#/usr/sbin/useradd
which useradd
```

`bin`和`sbin`

- 在`Linux`中，绝大多数可执行文件都是保存在`/bin`、 `/sbin`、 `/usr/bin` `usr/sbin`
- `/bin`（`binary`）是二进制执行文件目录，主要用于具体应用
- `/sbin` （`system binary`）是系统管理员专用的二进制代码存放目录，主要用于系统管理
- `/usr/bin` （`user commands for applications`）后期安装的一些软件
- `/usr/sbin` （ `super user commands for applications`）超级用户的一些管理程序

切换用户

| 命令      | 作用                   | 说明                                   |
| --------- | ---------------------- | -------------------------------------- |
| su-用户名 | 切换用户，并且切换目录 | 可以切换到用户家目录，否则保持位置不变 |
| exit      | 退出当前登录账户       |                                        |

> su 不接用户名，可以切换到 root，但是不推荐使用，因为不安全
>
>
> `exit`会退出当前登陆的用户，返回原来登陆的用户，如果当前登陆的用户是本用户，则退出 Shell

修改文件权限

| 命令  | 作用       |
| ----- | ---------- |
| chown | 修改拥有者 |
| chgrp | 修改组     |
| chmod | 修改权限   |

命令格式

```bash
#修改文件|目录的拥有者
chown 用户名 文件名|目录名

#递归修改文件|目录的组
chgrp -R 组名 文件名|目录名

#递归修改文件权限
chmod -R 755 文件名|目录名

```

> chmod 在设置权限时，可以简单地使用三个数字分别对应拥有者/组和其他用户的权限

```bash
#直接修改文件|目录的读|写|执行权限，但是不能精确到拥有者|组|其他
chmod +/-rwx 文件名|目录名

```

- 常见数字组合有（`u`表示用户/`g`表示组/`o`表示其他）
- 777 u=rwx，g=rwx，o=rwx
- 755 u=rwx，g=rx，o=rx
- 644 u=rw，g=r，o=r

## 7.2 用户管理

### 用户与组简介

- Linux系统是一个多用户、多任务的分时操作系统
- 用户需要向系统管理员申请一个账号才能使用系统
- 每个用户账号都拥有一个唯一的用户名和各自的口令（密码）
- 每个用户都具有一个唯一的身份标识，这个身份标识，称作用户ID（简称UID）

7.1.2用户种类

- 超级用户（root）
- 管理用户
- 普通用户

图

**Root账户**

- 超级用户（root)是一个特殊的用户
- 每个用户都有一个UID方便系统识别，root的UID为0
- root拥有最高权限，不受权限的限制，可以操作任何程序和文件
- 在Ubuntu中，默认root是被锁住的

**UID/GID**

- Linux系统不认识“账号”，Linux系统靠ID识别用户
- 用户ID是：UID
- 用户组ID是：GID
- ID是一个数字，账号是为了让使用者记忆方便
- root账户，UID为0
- 系统内建账号，UID在1-999之间
- 新建用户，默认UID>1000
- UID与账号的对应关系位于：/etc/passwd

**与用户管理相关的文件**

#用户的配置文件；/etc/passwd

- 包含所有用户的基本信息，所有用户都可以读取此文件
- 每个用户信息占一行
- 登陆Ubuntu系统时，输入用户名和密码之后
- 系统将会根据用户提供的用户名检查/etc/passwd文件
- 判断用户是否存在

**/etc/passwd**

数据保存格式：
username : passwd: uid : gid : comment : home : loginshell
数据保存格式字段详解：
1.用户名
2.密码（已经加密）
3.UID（用户标识），操作系统自已用的
4.GID组标识
5.用户全名或本地帐号
6.开始目录
7.登录使用的Shell，就是对登录命令进行解析的工具

#用户影子口令文件；/etc/shadow

- 影子密码文件，因passwd文件对所有人可读，为安全创建此文件
- 此文件用于存放系统内用户加密后的密码和用户登录控制信息
- 普通用户无法读取该文件，只有root用户才能读取该文件

数据保存格式：
username : passwd : lastchanged : minimum : maximum : alert : 字段7 : 字段8 : 字段9
数据保存格式字段详解
1.帐号名称
2.密码：这里是加密过的，但高手也可以解密的
3.自1/1/1970起，密码被修改的天数
4.密码不可被变更的天数
5.密码需要被重新变更的天数（99999表示不需要变更）
6.密码变更前提前几天警告
7.帐号失效日期
8.帐号取消日期
9.保留条目，目前没用

### 用户的添加与删除

**用户管理常用命令**

- useradd：添加用户
- userdel：删除用户
- passwd：设置密码
- usermod：修改用户（登录名，主目录等）
- finger:查看用户信息（需安装包：$sudo apt install finger)
- id:查看用户UID,GID及所属用户组
- su:切换用户

添加新用户

useradd「选项］用户名

| 选项     | 含义                                                    |
| -------- | ------------------------------------------------------- |
| -d dir   | 设置主目录                                              |
| -g group | 设置该账号的组－主要组：主要组只有1个，默认：用户私有组 |
| -s       | 设置登陆SHELL                                           |
| -u UID   | 设置ID                                                  |
| -G group | 设置该账号的组－附属组（可多个)                         |
| -m       | 自动建立用户的主目录                                    |

```bash
示例1：增加用户bob，指定其主目录为/home/hello
sudo useradd -d /home/hello -m -s /bin/bashbob
示例2：增加用户tom，指定UID为2000，且不能登录（禁用账户）
$sudo useraddd -u 2000 -s /bin/nologin tom
查看/etc/passwd文件以检测是否添加成功
```

设置密码
sudopasswd「选项］用户名

```bash
示例
passwd xjy //root为普通用户xjy设置密码
passwd //root重新设置自己的密码
sudo passwd tom //root权限为普通用户设置密码
```

删除用户
userdel「选项］用户名

| 选项 | 含义               |
| ---- | ------------------ |
| -r   | 删除用户及其主目录 |

```bash
示例
$sudo userdel -r jack
```

修改用户属性
usermod「选项］用户ID/用户名

| 选项        | 含义                         |
| ----------- | ---------------------------- |
| -d HOME_DIR | 用户的新主目录               |
| -g GROUP    | 使用GROUP为新主要组          |
| -G GROUPS   | 新的附加组列表GROUPS         |
| -s SHELL    | 该用户帐号的新登录shell      |
| -u UID      | 用户帐号的新UID              |
| -pU         | 解锁用户帐号（解除账户禁用） |

查看用户信息
finger［-s] 用户名
-s：使用长串数据输出格式

> 需要安装此命令$sudo apt install finger

```bash
示例
finger usero
```

7.1.4组的添加与册删除

查看用户UIDGID及所属用户组
id「选项］用户名

| 选项 | 含义                                         |
| ---- | -------------------------------------------- |
| -a   | 打印用户名、UID和该用户所属的所有组          |
| -G   | 输出所有不同的组ID（有效的，真实的和补充的） |
| -g   | 只输出有效的组ID                             |

**与用户组管理相关的文件**

#用户组（group）配置文件；/etc/group
组定义文件，每行一个组
数据保存格式：

1. gname : pwd: gid :userlist
2. gname:组名称
3. pwd:组密码，若为空则不需密码
4. gid:组标识
5. userlist:组成员，逗号分隔用户名

#用户组（group）的影子文件；/etc/gshadow
数据保存格式：组名：加密后的组口令：组群管理员：组群成员列表

1. 组名：用户组名称
2. 口令：密码栏，开头的“！”表示无法登录
3. 组群管理员：用户组管理员的账号
4. 组群成员列表：该用户组的所属账号（与/etc/group相同）

添加组
groupadd［选项］组名称

| 选项 | 含义                                             |
| ---- | ------------------------------------------------ |
| -g   | GID指定组群的gid                                 |
| -f   | 如果组群存在，退出并显示错误                     |
| -r   | 建立系统用户组，与/etc/login.defs内的GID_MIN有关 |

修改组名称
groupmod［选项］新名称 旧名称

| 选项       | 含义                     |
| ---------- | ------------------------ |
| -n newname | 更改组名称               |
| -g newGID  | 更改组的id（数字标识符） |

注意：不要随意修改GID，以免引起混乱

删除组
groupdel 组名称

gpasswd命令
功能：管理组
用法： gpasswd [-a user] [-d user] [-A user,...] [-M user,...] [-r] [-R]

| 选项 | 含义                                                 |
| ---- | ---------------------------------------------------- |
| -a   | 添加用户到组                                         |
| -d   | 从组删除用户                                         |
| -A   | 指定管理员                                           |
| -M   | 指定组成员和-A的用途差不多                           |
| -r   | 删除密码                                             |
| -R   | 限制用户登入组，只有组中的成员才可以用newgrp加入该组 |

## 7.3 用户身份转换命令

### 激活与锁定root用户

如何激活Root账户
1、执行命令$sudopasswdroot
系统提示为普通用户输入密码
2、输入root新密码
显示输入新的UNIX密码
需输入两遍
密码输入成功后，就为root用户设好密码并且激活



2、重新锁定root用户
重新锁定root用户
先转换到普通用户
执行命令：sudo passwd-l root命令

## 7.4软件包管理

**软件包简介**

- 软件包是UbuntuLinux系统中软件及其文档的提供形式。一般而言，软件包包括源程序软件包和二进制软件包。用户可以方便的通过二进制软件包进行安装、升级和删除软件。
- Ubuntu软件包的主要格式是DEB格式。deb包存在依赖关系，常见的依赖关系有Depends、Recommends和Conflicts等。
- Ubuntu系统还支持RedHat格式的软件包，即RPM格式。
- Ubuntu系统还支持Tarball格式的软件包。

**高级软件包管理工具APT**

**APT简介**
Ubuntu软件包管理系统的高级界面。APT由几个名字以“apt-”打头的程序组成，包括apt-get、apt-cache和apt-cdrom等，这些是处理软件包的命令行工具。

**apt-get命令**

- 用户可以通过在终端中输入“apt-get"命令查看其使用方法：
- apt提供了一个用于下载和安装软件包的简易命令行界面。最常用命令是update和install
- 以安装openssh-server为例演示aptinstall和remove参数的用法，sudo apt install openssh-server
- 通过ps-e命令查看ssh进程，确认ssh是否安装并启用，ps -e I grep ssh
- 卸载ssh，可以采用apt remove命令，sudo apt-get remove openssh-server

**软件安装**

通过 apt 安装/卸载软件

- `apt`是`Advanced Packaging Tool`，是`Linux`下的一款安装包管理工具
- 可以在终端中方便的安装/卸载/更新软件包

命令格式

```bash
#1.安装软件
sudo apt instal1软件包

#2.卸载软件
sudo apt remove软件名

#3.更新已安装的包
sudo apt upgrade

```

配置软件源

- 如果希望在`ubuntu`中安装软件， 更加快速，可以通过设置镜像源，选择一个访问网速更快的服务器来提供软件下载/安装服务
- 更换服务器之后，需要一个相对比较长时间的更新过程，需要耐心等待。更新完成后，再安装软件都会从新设置的服务器下载软件了

> 所谓镜像源，就是所有服务器的内容是相同的（镜像），但是根据所在位置不同，国内服务器通常速度会更快一些
