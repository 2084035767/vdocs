# 六、进程管理与系统监控

## 6.1 进程信息

进程：通俗地说就是当前正在执行的一个程序

| 命令               | 对应英文       | 作用                                |
| ------------------ | -------------- | ----------------------------------- |
| ps                 | process status | 查看进程的详细状况                  |
| jobs               |                | 查看系统中运行的任务                |
| nice               |                | 改变进程优先级                      |
| renice             |                | 进程执行时改变NI的值                |
| top                | top            | 动态显示运行中的进程并且排序        |
| kill [-9] 进程代号 | kill           | 终止指定代号的进程，-9 表示强行终止 |

### ps

> ps 默认只会显示当前用户通过终端启动的应用程序

| 选项 | 含义                   |
| ---- | ---------------------- |
| -a   | 列出所有信息           |
| -X   | 显示没有控制终端的进程 |
| -u   | 查看特定用户进程       |
| -e   | 显示所有进程           |
| -f   | 全格式                 |

### jobs

| 选项 | 含义                       |
| ---- | -------------------------- |
| -l   | 同时显示作业的PID          |
| -r   | 仅列出后台运行(run)的作业  |
| -s   | 仅列出后台暂停(stop)的作业 |

### nice

选项：常用的一个选项是“-n”，n值即为NI的值，n值的范围为-20一19。

n值越小优先级越高。即，-20代表最高的NI优先级，19代表最低的NI优先级。

不加选项，默认NI值为10。

> 说明：只有root用户才能提高请求进程的优先级，普通用户只能降低请求进程的优先级。

### renice

格式：renice [+/-n] [-g命令名...] [-p进程标识码..]［-u进程所有者...]

> 说明：可以通过命令名、进程标识码、进程所有者名指定要改变的进程的NI值

### kill

| 选项 | 含义                                                |
| ---- | --------------------------------------------------- |
| pid  | 要中止进程的ID号                                    |
| -n   | 表示信号，一般用9和15                               |
| -9   | 无条件终止某个进程                                  |
| -15  | 先让进程善后（关闭socket链接，清理临时文件等)再结束 |

### top

- 动态香看进程的变化
- top是一个动态显示过程，即可以通过用户按键来不断刷新当前状态
- top命令提供了实时的对系统处理器的状态监视
- top命令可以按CPU使用、内存使用和执行时间对任务进行排序

提示：

- 使用`kill`命令时，最好只终止由当前用户开启的进程，而不要终止`root`身份开启的进程，否则可能导致系统崩溃
- 要退出`top`可以直接输入`q`

## 6.2 进程管理

**进程管理**

- 进程是可并发执行的具有一定功能的程序段在给定数据集上的一次执行过程。
- 简而言之，进程就是程序的一次运行过程。
- 进程和程序的概念既相互联系文相互区别

**进程的特征**

- 并发性
- 独立性
- 动态性
- 异步性
- 结构性

图1

**进程控制块的作用**

1. 进程控制块的作用

- 为了描述和控制进程的运行，系统为每个进程定义了一个数据结构，该数据结构被称为进程控制块PCB
- PCB是进程存在的唯一标志。

2. 进程控制块中的内容
   - 进程标识符
   - 现行状态
   - 现场保留区
   - 程序与数据地址
   - 互斥与同步机构
   - 进程通信机构
   - 进程优先数
   - 资源清单
   - 家族联系
   - 链接字

**进程启动**

- 启动进程的过程即启动程序或者命令的过程
  启动进程的方式有两种：
  1. 前台启动方式
  2. 后台启动方式

1、前台方式启动进程

打开系统终端，在终端窗口的命令行提示符后输入命令并按回车键，就以前台方式启动了一个进程
示例：$ vi test
使用ps命令查看该进程的有关信息


2、后台方式启动进程

- 终端下以后台方式启动进程
- 要在执行的命令后面添加“&”



**进程处理**

| 命令                         | 对应英文 | 作用                     |
| ---------------------------- | -------- | ------------------------ |
| who                          | who      | 查看系统当前的在线用户   |
| last                         |          | 查看曾经登陆过系统的用户 |
| free                         | free     | 内存性能的监视           |
| -s：指定时间间隔进行持续监视 |          |                          |

1、改变进程的优先级

- 系统在为进程分配CPU等资源时，是通过优先级来进行判断的。

- 输入“PS-I”查看当前用故进程的优先级


2、挂起和激活进程

- 挂起当前正在运行的前台进程：
- Ctl+z
- 激活被挂起的进程有两种方式：
- fg命令：使被挂起的进程返回至前台运行
- bg命令：激活被挂起的进程，使之在后台运行
  - 选项：%命令序号


 3、结束进程

- 当某个进程已经僵死或者占用了大量CPU时间，就需要将该进程终止或者撤销该进程
- 终止前台进程：Ctl+c
- 终止后台作业(backgroundjob)
  1. 用fg命令把该作业转换为前台作业，然后使用 Ctrl+c
  2. 使用kill命令，关掉进程

**系统日志**

- 日志文件（LogFiles）
- 用于记录系统操作事件的记录文件或文件集合。
- 系统日志文件是包含关于系统消息的文件，包括内核、服务、在系统上运行的应用程序等。不同的日志文件记载不同的信息。
- 日志文件所处的位置都在/var/log目录下，通过ls命令可以查看该目录下的详细日志文件都有哪些。
- 用户可以使用文本编辑器打开并查看某个日志文件内容。



**系统服务**

- 系统服务是一种应用程序类型，它在后台运行
- 与运行程序相比，服务不会出现程序窗口或对话租
- 服务应用程序通常可以在本地和通过网络为用户提供一些功能
- 例如客户端/服务器应用程序、Web服务器、数据库服务器以及其他基于服务器的应用程序

**systemd命令**

- 列出正在运行的服务状态：systemctl
- 服务启动/停止/重启/状态：systemctl start/stop/restart/status服务名称
- 允许/禁止服务开机启动：systemctlenable/disable服务名称
- 查看服务是否开机启动：systemctlis-enabled服务名称
- 查看已启动的服务列表：systemctl list-unit-files
- 查看已启动的某个服务：systemctl list-unit-filesgrep服务名称
