# 第五章：输入输出系统

## 5.1 I/O设备的分类和特点



### 什么是I/O设备

I/O设备又可以称为外部设备，所谓的I/O其实指的就是输入和输出，‍‍I代表的是input，O代表的是output，‍‍

‍

### I/O设备的分类

如果按使用特性来分的话，I/O设备可以分为这样的三种类型，‍‍

第一种叫做人机交互类的外部设备

第二种叫做存储设备，

第三种叫做网络通信设备，



‍

‍

如果按照传输速率来分类的话

低速设备就是像什么鼠标键盘这样的设备，

中速设备的话一般来说传输速率是每秒钟数千至上万个字节，‍‍比如说激光打印机，

高速设备的话就是每秒数千个字节，甚至还要更快。‍‍像平时咱们使用的移动硬盘



第三种分类方式就是按照信息交换的单位进行分类，‍‍

块设备，像平时咱们使用的移动硬盘磁盘等等，这些就属于块设备。‍‍它的数据传输的基本单位是一块一块进行的，这种设备的特点是传输速率会比较高，并且可寻址。‍‍所谓可寻址就是指这种设备可以随机的读写任意的一块，‍‍

字符设备的话，就是类似于鼠标键盘这种数据的传输基本单位是字符或者字节，‍‍所以这种类型的设备传输速度一般会比较慢，并且不可寻址，在输入输出的时候，一般来说会采用中断驱动的方式，‍





### 磁盘、磁道和扇区

磁盘它的表面是由一组磁性物质组成，‍‍可以用这些磁性物质来记录我们的那些二进制数据，





### 如何在磁盘中读/写数据



‍

‍

### 磁盘分类



这是按照磁头是否可以移动来进行划分的两种分类

活动头磁盘

固定头磁盘。‍



‍

这些盘片到底是否可以更换，

可换盘磁盘

固定盘磁盘

‍

‍





‍

‍

## 5.2 I/O控制方式



### 程序直接控制方式

我们首先要了解的是程序直接控制方式，这也是最早期的一种IO控制方式，



需要掌握的一个重点的核心词叫做轮巡



‍

### 中断驱动方式

让CPU在发出IO指令之后，转头可以做别的事情，‍‍也就是可以切换到别的进程。‍‍



### DMA方式

DMA方式主要就是为了解决中断驱动方式留下的那几个问题， DMA方式的中文名又叫直接存储器存取。‍‍所以在遇到这个名词的时候，大家也需要知道它指的就是DMA，这种方式主要用于对于块设备的‍‍这种IO控制，

* 相比于中断驱动方式，DMA方式的数据传送单位由字变为了块，‍‍每次会读入或者写出一个块。‍‍
* 另外数据的流向不再需要经过CPU，而是可以在DNA控制器的控制下，‍‍直接从设备放入到内存，或者直接从内存写出到设备。‍‍
* 第三，CPU对于IO操作的干预频率有进一步的降低，仅仅在传送一个或者多个数据块的开始和结束的时候，才需要CPU进行干预。‍‍

‍



### 通道控制方式

通道其实它是一种硬件，‍‍大家可以把通道理解为是一种弱机版的CPU。通道可以识别并且执行一系列的通道指令，‍‍就类似于咱们CPU识别的那些指令一样



‍

### I-O控制器



### IO控制器的组成

这样的三个部分，第一个部分是CPU与控制器的接口，‍‍第二个部分叫IO逻辑，第三个部分就是控制器与设备之间的接口。‍‍



### 内存映像IO vs 寄存器独立编制

## 5.3 缓冲区管理



### 什么是缓冲区

缓冲区就是一个存储区域，‍‍可以由专门的硬件寄存器组成，也可以由内存作为缓冲区，如果用硬件作为专门的缓冲区的话，一般来说成本会比较高，‍‍并且容量比较小。



‍



### 缓冲区的作用

‍首先来看一下缓冲区有什么作用。在内存中可以开辟一小片区域作为缓冲区

‍

### 单缓冲

单缓冲区的策略，那操作系统会在储存当中‍‍为用户进程分配一个缓冲区，而缓冲区的大小和块是相等的。‍‍



### 双缓冲策略

双缓冲策略，操作系统会在储存当中为进程分配两个缓冲区，‍‍同样的每个缓冲区的大小也是一个快，

‍

### 单缓冲和双缓冲在通信时的区别



‍

### 循环缓冲区

循环缓冲区，操作系统可以给一个进程分配多个大小相等的缓冲区，让这些缓冲区连成一个循环的队列。‍‍

‍

### 缓冲池

缓冲池其实是由一系列的缓冲区组成的，就像它这个名字一样，‍‍缓冲池其实就是放满了各种各样缓冲区的一个池子，‍‍当我们需要使用一个缓冲区或者要归还一个缓冲区的时候，就可以对池子当中的各种缓冲区进行操作就可以了







## 5.4 I-O核心子系统

‍层次可以分为这样的4个层次，其中设备独立性软件、‍‍设备驱动程序，还有终端处理程序，这三层其实是属于操作系统的内核部分的，‍‍所以它们也称作IO核心子系统，又可以简称为IO系统。‍‍




‍

### IO子系统的功能



### lO调度

其实IO调度和‍‍处理基调度是很类似的，就是用某一种算法来确定一个好的顺序来处理各个IO请求。‍‍





### 设备保护



### ‍假脱机技术



### 什么是脱机技术





‍

### 假脱机技术





‍



‍

‍

‍







### 设备的分配与回收





‍

### 设备分配时应该考虑哪些因素

首先来看一下设备分配时应该考虑哪些因素，我们应该考虑设备的固有属性，设备的分配算法，‍‍还有设备分配中的安全性

设备的固有属性可以分为这样的三种，独占设备，‍‍共享设备和虚拟设备

* 独占设备就是一个时间段内只能分配给一个进程使用的那些设备。‍‍比如说咱们很熟悉的打印机
* 共享设备，‍‍可以同时分配给多个进程使用的那种设备，比如说像磁盘，‍‍但是所谓的这种共享其实是宏观上共享，但微观上各个进程‍‍有可能是交替的使用这个设备的。‍‍
* 虚拟设备其实就是我们上个小节介绍的，采用SPOOLing技术，‍‍把独占设备改造成虚拟的共享设备，在采用了SPOOLing技术之后，我们可以把‍‍独占式的打印机改造成共享打印机，并且把它同时分配给多个进程使用，‍‍这是我们需要考虑的设备的固有属性。‍‍

‍

‍



### 静态分配和动态分配

静态分配就是指进程运行之前就为其分配它所需要的全部资源，一直到进程运行结束之后，‍‍才把资源归还给系统。而如果说进程在运行之前，他所需要的全部资源，‍‍暂时得不到完全的满足的话，那么进程就暂时不能投入运行，

‍

### 设备分配管理当中的数据结构

设备控制表

控制器控制表

通道控制表

系统设备表





### 设备分配的步骤



## 5.5 I/O调度算法

